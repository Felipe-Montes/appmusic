{
  "info": {
    "_postman_id": "b1e3f5a2-9c4b-4d0c-8d1b-1c2d3e4f5a6b",
    "name": "AppMusic API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Colección Postman para AppMusic. Cuerpos sin null y relaciones por ID para conectar con datos existentes o ingresar nuevos."
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:8080" },
    { "key": "artistId", "value": "ART-001" },
    { "key": "albumId", "value": "ALB-001" },
    { "key": "songId", "value": "SON-001" },
    { "key": "userId", "value": "USR-001" },
    { "key": "playlistId", "value": "PLY-001" },
    { "key": "historyId", "value": "HIS-001" }
  ],
  "item": [
    {
      "name": "Artists",
      "item": [
        { "name": "List Artists", "request": { "method": "GET", "url": "{{baseUrl}}/artists" } },
        { "name": "Get Artist by ID", "request": { "method": "GET", "url": "{{baseUrl}}/artists/{{artistId}}" } },
        {
          "name": "Create Artist (UI fields)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/artists",
            "body": { "mode": "raw", "raw": "{\n  \"idArtist\": \"{{artistId}}\",\n  \"name\": \"Queen\"\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.idArtist) pm.collectionVariables.set('artistId', data.idArtist);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Artist",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/artists",
            "body": { "mode": "raw", "raw": "{\n  \"idArtist\": \"{{artistId}}\",\n  \"name\": \"Queen Updated\"\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.idArtist) pm.collectionVariables.set('artistId', data.idArtist);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        { "name": "Delete Artist", "request": { "method": "DELETE", "url": "{{baseUrl}}/artists/{{artistId}}" } }
      ]
    },
    {
      "name": "Albums",
      "item": [
        { "name": "List Albums", "request": { "method": "GET", "url": "{{baseUrl}}/albums" } },
        { "name": "Get Album by ID", "request": { "method": "GET", "url": "{{baseUrl}}/albums/{{albumId}}" } },
        {
          "name": "Create Album (UI fields)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/albums",
            "body": { "mode": "raw", "raw": "{\n  \"id\": \"{{albumId}}\",\n  \"title\": \"A Night at the Opera\",\n  \"duration\": 43.0,\n  \"artist\": { \n    \"idArtist\": \"{{artistId}}\"\n  }\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.id) pm.collectionVariables.set('albumId', data.id);",
                  "  if (data.artist && data.artist.idArtist) pm.collectionVariables.set('artistId', data.artist.idArtist);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Album",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/albums",
            "body": { "mode": "raw", "raw": "{\n  \"id\": \"{{albumId}}\",\n  \"title\": \"A Night at the Opera (Remastered)\",\n  \"duration\": 44.5,\n  \"artist\": { \n    \"idArtist\": \"{{artistId}}\"\n  }\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.id) pm.collectionVariables.set('albumId', data.id);",
                  "  if (data.artist && data.artist.idArtist) pm.collectionVariables.set('artistId', data.artist.idArtist);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        { "name": "Delete Album", "request": { "method": "DELETE", "url": "{{baseUrl}}/albums/{{albumId}}" } }
      ]
    },
    {
      "name": "Songs",
      "item": [
        { "name": "List Songs", "request": { "method": "GET", "url": "{{baseUrl}}/songs" } },
        { "name": "Get Song by ID", "request": { "method": "GET", "url": "{{baseUrl}}/songs/{{songId}}" } },
        {
          "name": "Create Song (UI fields)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/songs",
            "body": { "mode": "raw", "raw": "{\n  \"id\": \"{{songId}}\",\n  \"title\": \"Bohemian Rhapsody\",\n  \"duration\": 5.55,\n  \"musicGenre\": \"ROCK\",\n  \"artist\": { \n    \"idArtist\": \"{{artistId}}\"\n  },\n  \"album\": {\n    \"id\": \"{{albumId}}\"\n  }\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.id) pm.collectionVariables.set('songId', data.id);",
                  "  if (data.artist && data.artist.idArtist) pm.collectionVariables.set('artistId', data.artist.idArtist);",
                  "  if (data.album && data.album.id) pm.collectionVariables.set('albumId', data.album.id);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Song",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/songs",
            "body": { "mode": "raw", "raw": "{\n  \"id\": \"{{songId}}\",\n  \"title\": \"Bohemian Rhapsody (Live)\",\n  \"duration\": 6.1,\n  \"musicGenre\": \"ROCK\",\n  \"artist\": { \n    \"idArtist\": \"{{artistId}}\"\n  },\n  \"album\": {\n    \"id\": \"{{albumId}}\"\n  }\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.id) pm.collectionVariables.set('songId', data.id);",
                  "  if (data.artist && data.artist.idArtist) pm.collectionVariables.set('artistId', data.artist.idArtist);",
                  "  if (data.album && data.album.id) pm.collectionVariables.set('albumId', data.album.id);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        { "name": "Delete Song", "request": { "method": "DELETE", "url": "{{baseUrl}}/songs/{{songId}}" } }
      ]
    },
    {
      "name": "Users",
      "item": [
        { "name": "List Users", "request": { "method": "GET", "url": "{{baseUrl}}/users" } },
        { "name": "Get User by ID", "request": { "method": "GET", "url": "{{baseUrl}}/users/{{userId}}" } },
        {
          "name": "Create User (UI fields)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/users",
            "body": { "mode": "raw", "raw": "{\n  \"idUser\": \"{{userId}}\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\",\n  \"subscriptionType\": \"FREE\"\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.idUser) pm.collectionVariables.set('userId', data.idUser);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        {
          "name": "Update User",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/users",
            "body": { "mode": "raw", "raw": "{\n  \"idUser\": \"{{userId}}\",\n  \"name\": \"John Doe Updated\",\n  \"email\": \"john.updated@example.com\",\n  \"subscriptionType\": \"PREMIUM\"\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.idUser) pm.collectionVariables.set('userId', data.idUser);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        { "name": "Delete User", "request": { "method": "DELETE", "url": "{{baseUrl}}/users/{{userId}}" } }
      ]
    },
    {
      "name": "Playlists",
      "item": [
        { "name": "List Playlists", "request": { "method": "GET", "url": "{{baseUrl}}/playlists" } },
        { "name": "Get Playlist by ID", "request": { "method": "GET", "url": "{{baseUrl}}/playlists/{{playlistId}}" } },
        {
          "name": "Create Playlist (UI fields)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/playlists",
            "body": { "mode": "raw", "raw": "{\n  \"idPlaylist\": \"{{playlistId}}\",\n  \"name\": \"Favorites\",\n  \"user\": {\n    \"idUser\": \"{{userId}}\"\n  },\n  \"songs\": [\n    { \n      \"id\": \"{{songId}}\"\n    }\n  ]\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.idPlaylist) pm.collectionVariables.set('playlistId', data.idPlaylist);",
                  "  if (data.user && data.user.idUser) pm.collectionVariables.set('userId', data.user.idUser);",
                  "  if (data.songs && data.songs.length && data.songs[0].id) pm.collectionVariables.set('songId', data.songs[0].id);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Playlist",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/playlists",
            "body": { "mode": "raw", "raw": "{\n  \"idPlaylist\": \"{{playlistId}}\",\n  \"name\": \"Favorites Updated\",\n  \"user\": {\n    \"idUser\": \"{{userId}}\"\n  },\n  \"songs\": [\n    { \n      \"id\": \"{{songId}}\"\n    }\n  ]\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.idPlaylist) pm.collectionVariables.set('playlistId', data.idPlaylist);",
                  "  if (data.user && data.user.idUser) pm.collectionVariables.set('userId', data.user.idUser);",
                  "  if (data.songs && data.songs.length && data.songs[0].id) pm.collectionVariables.set('songId', data.songs[0].id);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        { "name": "Delete Playlist", "request": { "method": "DELETE", "url": "{{baseUrl}}/playlists/{{playlistId}}" } }
      ]
    },
    {
      "name": "Play History",
      "item": [
        { "name": "List Play History", "request": { "method": "GET", "url": "{{baseUrl}}/play-history" } },
        { "name": "Get Play History by ID", "request": { "method": "GET", "url": "{{baseUrl}}/play-history/{{historyId}}" } },
        {
          "name": "Create Play History (UI-like fields)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{baseUrl}}/play-history",
            "body": { "mode": "raw", "raw": "{\n  \"idHistory\": \"{{historyId}}\",\n  \"user\": {\n    \"idUser\": \"{{userId}}\"\n  },\n  \"song\": {\n    \"id\": \"{{songId}}\"\n  },\n  \"playDate\": \"2025-01-01T12:00:00\"\n}" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : '{}';",
                  "  const data = JSON.parse(raw);",
                  "  if (data.idHistory) pm.collectionVariables.set('historyId', data.idHistory);",
                  "  if (data.user && data.user.idUser) pm.collectionVariables.set('userId', data.user.idUser);",
                  "  if (data.song && data.song.id) pm.collectionVariables.set('songId', data.song.id);",
                  "} catch (e) { /* ignore */ }"
                ]
              }
            }
          ]
        },
        { "name": "Delete Play History", "request": { "method": "DELETE", "url": "{{baseUrl}}/play-history/{{historyId}}" } }
      ]
    },
    {
      "name": "Payments",
      "item": [
        {
          "name": "Reporte de Pagos (Tabla)",
          "request": {
            "method": "GET",
            "header": [ { "key": "Accept", "value": "application/json" } ],
            "url": "{{baseUrl}}/payments/report",
            "description": "Reporte de pagos por fecha y tipo de suscripción. Solo se muestran PREMIUM y FAMILY.\n\n| Fecha | FAMILY | PREMIUM | Total |\n|---|---:|---:|---:|\n| 2025-11-12 | 1,000,000 | 3,000,000 | 4,000,000 |\n| 2025-11-13 | 0 | 5,000,000 | 5,000,000 |\n| 2025-11-14 | 3,000,000 | 6,000,000 | 9,000,000 |"
          },
          "response": [
            {
              "name": "Ejemplo - Lista de días",
              "originalRequest": { "method": "GET", "url": "{{baseUrl}}/payments/report" },
              "status": "OK",
              "code": 200,
              "header": [ { "key": "Content-Type", "value": "application/json" } ],
              "body": "[\n  {\n    \"fecha\": \"2025-11-12\",\n    \"subscripciones\": [\n      { \"tipo_sub\": \"FAMILY\", \"valor\": 1000000 },\n      { \"tipo_sub\": \"PREMIUM\", \"valor\": 3000000 }\n    ],\n    \"total_tipo\": 4000000\n  },\n  {\n    \"fecha\": \"2025-11-13\",\n    \"subscripciones\": [\n      { \"tipo_sub\": \"FAMILY\", \"valor\": 0 },\n      { \"tipo_sub\": \"PREMIUM\", \"valor\": 5000000 }\n    ],\n    \"total_tipo\": 5000000\n  },\n  {\n    \"fecha\": \"2025-11-14\",\n    \"subscripciones\": [\n      { \"tipo_sub\": \"FAMILY\", \"valor\": 3000000 },\n      { \"tipo_sub\": \"PREMIUM\", \"valor\": 6000000 }\n    ],\n    \"total_tipo\": 9000000\n  }\n]"
            },
            {
              "name": "Ejemplo - Rango de fechas",
              "originalRequest": { "method": "GET", "url": "{{baseUrl}}/payments/report?from=2025-11-12&to=2025-11-14" },
              "status": "OK",
              "code": 200,
              "header": [ { "key": "Content-Type", "value": "application/json" } ],
              "body": "{\n  \"fecha_inicial\": \"2025-11-12\",\n  \"fecha_final\": \"2025-11-14\",\n  \"dias\": [\n    {\n      \"fecha\": \"2025-11-12\",\n      \"subscripciones\": [\n        { \"tipo_sub\": \"FAMILY\", \"valor\": 1000000 },\n        { \"tipo_sub\": \"PREMIUM\", \"valor\": 3000000 }\n      ],\n      \"total_tipo\": 4000000\n    },\n    {\n      \"fecha\": \"2025-11-13\",\n      \"subscripciones\": [\n        { \"tipo_sub\": \"FAMILY\", \"valor\": 0 },\n        { \"tipo_sub\": \"PREMIUM\", \"valor\": 5000000 }\n      ],\n      \"total_tipo\": 5000000\n    },\n    {\n      \"fecha\": \"2025-11-14\",\n      \"subscripciones\": [\n        { \"tipo_sub\": \"FAMILY\", \"valor\": 3000000 },\n        { \"tipo_sub\": \"PREMIUM\", \"valor\": 6000000 }\n      ],\n      \"total_tipo\": 9000000\n    }\n  ]\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "UI Endpoints (formularios)",
      "item": [
        { "name": "UI Home", "request": { "method": "GET", "url": "{{baseUrl}}/ui" } },
        { "name": "UI Artists", "request": { "method": "GET", "url": "{{baseUrl}}/ui/artists" } },
        { "name": "UI Albums", "request": { "method": "GET", "url": "{{baseUrl}}/ui/albums" } },
        { "name": "UI Songs", "request": { "method": "GET", "url": "{{baseUrl}}/ui/songs" } },
        { "name": "UI Users", "request": { "method": "GET", "url": "{{baseUrl}}/ui/users" } },
        { "name": "UI Playlists", "request": { "method": "GET", "url": "{{baseUrl}}/ui/playlists" } }
      ]
    }
  ]
}
